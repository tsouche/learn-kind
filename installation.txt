#!/bin/bash



echo "================================================="
echo "Fist: install docker"
echo "================================================="
echo

# Install docker (as root)
apt-get update
apt-get install -y docker.io
systemctl enable docker
systemctl start docker
# create the user/group to be able to use it as 'vagrant' regular user
groupadd docker
usermod -aG docker vagrant


echo "================================================="
echo "Second: install GO v1.13"
echo "================================================="
echo

add-apt-repository ppa:longsleep/golang-backports
apt-get update
apt-get install -y golang-1.13
export PATH=$PATH:/usr/lib/go-1.13/bin




echo " "
echo " "
echo "================================================="
echo "Third: install kind v0.6.1"
echo "================================================="
echo " "
echo " "

# The binary file is available in the shared directory: copy it in t a bin directory
cd /project/kind/binaries
curl -Lo ./kind-v0.6.1-Linux-amd64 https://github.com/kubernetes-sigs/kind/releases/download/v0.6.1/kind-Linux-amd64
sudo cp /projects/kind/binaries/kind-v0.6.1-Linux-amd64 /usr/lib/go-1.13/bin/kind
sudo chmod +x /usr/lib/go-1.13/bin/kind



echo " "
echo " "
echo "================================================="
echo "Third: install kubectl v1.16.4"
echo "================================================="
echo " "
echo " "

# DO NOT install the altest version, but the version 1.15 which is compliant 
# with kind (at least this version of kind).
cd /project/kind/binaries
curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.16.4/bin/linux/amd64/kubectl
sudo cp /projects/kind/binaries/kubectl-v1.16.4-linux-amd64 /usr/local/bin/kubectl
sudo chmod +x /usr/local/bin/kubectl



echo " "
echo " "
echo "================================================="
echo "END: update the PATH for all users"
echo "================================================="
echo " "
echo " "

echo "================================="
echo "/etc/profile/ avant:"
cat /etc/profile
echo "================================="

cat <<EOF >> /etc/profile

PATH=$PATH::/usr/lib/go-1.13/bin/
EOF

echo "================================="
echo "/etc/profile/ aprÃ¨s:"
cat /etc/profile
echo "================================="

cd /projects/kind/


#echo $PATH >> /etc/profile
source /etc/profile
